<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxmox Server - Backups</title>
    <link rel="stylesheet" href="../../styles.css">
    <style>
        /* Timeline-Style with Image Placeholders */
        .section-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .section-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #1d1d1f;
            border-bottom: 2px solid #f5f5f7;
            padding-bottom: 0.5rem;
        }

        .section-card h3 {
            font-size: 1.2rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #0071e3;
        }

        .section-card ul {
            list-style: none;
            padding-left: 0;
        }

        .section-card li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .section-card li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #0071e3;
            font-weight: bold;
        }

        .project-details {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .content-block {
            margin-bottom: 3rem;
            padding-left: 2rem;
            border-left: 3px solid #e5e5e7;
            position: relative;
        }

        .content-block:before {
            content: "";
            position: absolute;
            left: -9px;
            top: 0;
            width: 15px;
            height: 15px;
            background: #0071e3;
            border-radius: 50%;
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px #e5e5e7;
        }

        .content-block h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #1d1d1f;
        }

        .content-block h3 {
            font-size: 1.15rem;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #0071e3;
            font-weight: 500;
        }

        .screenshot-placeholder {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            margin: 1.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6e6e73;
            font-size: 0.9rem;
            overflow: hidden;
        }

        .screenshot-placeholder img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .image-grid .screenshot-placeholder {
            margin: 0;
            height: 250px;
        }

        @media (max-width: 600px) {
            .image-grid {
                grid-template-columns: 1fr;
            }
        }

        .btn-next-milestone {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #0071e3;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 980px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.2);
        }

        .btn-next-milestone:hover {
            background: #0077ed;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 113, 227, 0.3);
        }

        .btn-next-milestone:after {
            content: "→";
            font-size: 1.2rem;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            font-size: 0.95rem;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e5e7;
            vertical-align: top;
        }

        th {
            background-color: #f5f5f7;
            font-weight: 600;
            color: #1d1d1f;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 3rem 0 2rem;
            flex-wrap: wrap;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #f5f5f7;
            color: #1d1d1f;
            padding: 0.75rem 1.5rem;
            border-radius: 980px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: #e8e8ed;
        }

        .btn-back:before {
            content: "←";
            font-size: 1.2rem;
        }

        .code-snippet {
            background: #1d1d1f;
            color: #f5f5f7;
            padding: 1rem 1.25rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .project-details {
                padding: 1rem;
            }

            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>

<body>
    <nav class="nav-bar">
        <div class="nav-container">
            <a href="../../index.html" class="nav-logo">Proxmox Server</a>
            <ul class="nav-links">
                <li><a href="../../index.html">Home</a></li>
                <li><a href="../../projects.html" class="active">Projects</a></li>
                <!-- <li><a href="../../resume.html">Resume</a></li> -->
            </ul>
        </div>
    </nav>

    <main>
        <section class="projects-header">
            <h1>Backups</h1>
        </section>
        <div class="section-card">
            <p><strong>Preface: </strong>I originally intended to use a separate, bare-metal system for backups.
                However, my
                collection of Dell Optiplexes that I hoped to use for this project all seem to have stopped working in
                storage. Fixing up Haswell-era Dells
                is
                beyond the scope of this project (and also a waste of time and money), so for the time being, I am
                virtualizing Proxmox Backup Server. I am aware of the risks this entails-- if the system that I am
                backing
                up
                (which also hosts my backups) fails, I could be out of luck. However, I feel with passing through
                physical
                drives for both the OS and storage drives, I will have a portable system I can transfer into a new
                system
                and
                keep on running. This also lets me sink my teeth into PBS without investing more money and power. So,
                for
                the
                time being, I feel like I've got a solid middle ground solution. </p>
        </div>
        <section class="project-details">
            <div class="section-card">
                <div class="content-block">
                    <h2>VM Configuration</h2>
                    <ul>
                        <p>Since I'm passing through physical drives to my VM, there is a bit
                            more prep-work to be done than with a normal VM. </p>
                        <h3>Finding Disk IDs</h3>
                        <p>Instead of passing through disk names like /dev/sda, which can change after a reboot, passing
                            through device UUIDs is a far safer option. The command <code>ls -l /dev/disk/by-id</code>
                            will
                            list the UUIDs of all disks connected to the system. The three disks I'm passing through
                            are:
                        </p>
                    </ul>
                    <div class="code-snippet">
                        <p>/dev/disk/by-id/ata-KINGSTON_SA400S37240G_50026B768765078E</p>
                        <p>/dev/disk/by-id/ata-ST4000DM004-2CV104_ZTT3AWX5</p>
                        <p>/dev/disk/by-id/ata-ST4000DM004-2U9104_ZFN5S6AZ</p>
                    </div>


                    <h3>Creating the VM</h3>
                    <li><strong>VM ID: </strong>101</li>
                    <li><strong>CPU: </strong>4 cores</li>
                    <li><strong>RAM: </strong>8GB. 4 for the OS, 4 for ZFS caching. ZFS recommends 1GB per TB of storage
                        in
                        this type of workload.
                    </li>
                    <li><strong>Other settings: </strong>Default platform, VirtIO SCSI controller, guest agent and start
                        at
                        boot enabled.</li>
                    <li><strong>Storage: </strong>No disks created. My physical disks will need to be passed through
                        later.
                    </li>
                    <div class="screenshot-placeholder">
                        <img src="assets/section4/vmcreated.png" alt="Created VM Screenshot">
                    </div>
                    <ul>
                        <p><strong>Disk passthrough:</strong> This is where I passed through the UUID's I gathered
                            earlier.
                            The command to pass through disks is <code>qm set "vm id" -scsi"x" "uuid"</code></p>
                        <div class="code-snippet">
                            <p>> qm set 101 -scsi0 /dev/disk/by-id/ata-KINGSTON_SA400S37240G_50026B768765078E</p>
                            <p>> qm set 101 -scsi1 /dev/disk/by-id/ata-ST4000DM004-2CV104_ZTT3AWX5</p>
                            <p>> qm set 101 -scsi2 /dev/disk/by-id/ata-ST4000DM004-2U9104_ZFN5S6AZ</p>
                        </div>
                        <p>Set scsi0 as the boot disk in the Boot Order section within the Options tab of the VM. That
                            also isn't done automatically.
                        </p>
                        <div class="image-grid">
                            <div class="screenshot-placeholder">
                                <img src="assets/section4/disksadded.jpg" alt="Disks Added Screenshot">
                            </div>
                            <div class="screenshot-placeholder">
                                <img src="assets/section4/pbsoptions.png" alt="Proxmox Backup Options Screenshot">
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
            <div class="section-card">
                <div class="content-block">
                    <h2>PBS Installation and Configuration</h2>
                    <p>After mounting the PBS ISO from the PVE-created ISO directory, The VM booted into the installer
                        and
                        found my disks</p>
                    <h3>Installation</h3>
                    <li>PBS is installed onto the SSD with default settings, EXT4 filesystem, default network settings.
                    </li>

                    <div class="screenshot-placeholder">
                        <img src="assets/section4/pbsinstall.png" alt="PBS Install Screenshot">
                    </div>
                    <h3>Post-Install Configuration</h3>
                    <li><strong>Networking: </strong>DHCP reservation was created on the router for the PBS IP
                        (10.0.1.13)
                    </li>
                    <li><strong>Security:</strong> Configured 2FA TOTP for the administrative user and disabled paid
                        subscription repository.</li>
                    <li>Updated system with <code>apt update && apt upgrade -y</code></li>
                    <li>QEMU Guest Agent installed with
                        <code>apt install qemu-guest-agent -y && systemctl start qemu-guest-agent && systemctl enable qemu-guest-agent</code>
                    </li>
                    <div class="screenshot-placeholder">
                        <img src="assets/section4/pbsbooted.png" alt="PBS Booted Screenshot">
                    </div>
                </div>
            </div>
            <div class="section-card">
                <div class="content-block">
                    <h2>Storage Configuration</h2>
                    <li>ZFS Mirror created for my HDDs (HDDMirror)</li>
                    <li><strong>Pruning Policy: </strong> 7 Daily, 4 Weekly, 12 Monthly. 1 backup per day for the
                        most
                        recent week, 1 backup per week for the most recent month, and 1 backup per month for the
                        most
                        recent
                        year.</li>
                    <li><strong>Garbage Collection: </strong> Nightly at 1 AM</li>
                    <li>Verify job runs on the first of the month at midnight</li>
                    <li>Non-root user created on PBS with <code>DataStoreBackup</code> role.</li>
                </div>
            </div>
            <div class="section-card">
                <div class="content-block">
                    <h2>Backup Configuration</h2>
                    <li>PBS added to PVE storage pool via Datacenter > Storage > Add > Proxmox Backup Server</li>
                    <li>Use the non-root user created on PBS to authenticate to the storage pool</li>
                    <li>Backup job created for the entire pool <strong>EXCEPT </strong> the PBS VM (id 101). This
                        ensures I
                        won't be recursively backing the PBS to itself. Twice daily at 2AM and 10:30 PM</li>
                    <div class="screenshot-placeholder">
                        <img src="assets/section4/backup.png" alt="Backup Job Screenshot">
                    </div>
                </div>
            </div>

        </section>
        <div class="navigation-buttons">
            <a href="remotemanagement.html" class="btn-back">Back to Remote Management</a>
            <a href="conclusion.html" class="btn-next-milestone">Conclusion</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Joseph Broda</p>
    </footer>
</body>

</html>